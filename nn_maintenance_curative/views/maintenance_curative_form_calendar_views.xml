<odoo>
    <!-- Nouvelle Vue Liste -->
    <record id="view_maintenance_curative_form" model="ir.ui.view">
        <field name="name">maintenance.curative.form</field>
        <field name="model">maintenance.curative</field>
        <field name="arch" type="xml">
            <form string="Fiche d'Intervention Curative">
                <header>
                    <field name="state" widget="statusbar" readonly="True"/>

                </header>
                <sheet>
                    <group>
                        <field name="demandeur_hr" attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                        <field name="equipment_id" attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                        <field name="reference_interne" required="1"
                               attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                        <field name="sn" attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                        <field name="declaration_date"
                               attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                        <field name="problem_description" string="Problem Description"
                               attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                        <field name="date_effective" string="Date Effective"
                               attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                        <field name="date_intervention"
                               attrs="{'readonly': [('state', '!=', 'declaration')]}"/>
                    </group>

                    <!-- Phase 2: Diagnostic & Planification -->
                    <!-- Phase 2: Diagnostic & Planification -->
                    <group>
                        <field name="existing_intervenant" string="Intervenant Existe"
                               attrs="{'readonly': [('state', '!=', 'diagnostic')]}"

                        />
                        <field name="intervenant_hr"
                               attrs="{
           'readonly': [('state', '!=', 'diagnostic')],
           'invisible': ['|', ('state', '=', 'declaration'), ('existing_intervenant', '=', False)]
       }"
                               string="Nom et Prénom de l'Intervenant"/>
                        <field name="nom_intervenant"
                               attrs="{
           'readonly': [('state', '!=', 'diagnostic')],
           'invisible': ['|', ('state', '=', 'declaration'), ('existing_intervenant', '=', True)]
       }"/>

                        <field name="heure_debut"
                               attrs="{'readonly': [('state', '!=', 'diagnostic')],
                   'invisible': [('state', '=', 'declaration')]}"/>
                        <field name="heure_fin"
                               attrs="{'readonly': [('state', '!=', 'diagnostic')],
                   'invisible': [('state', '=', 'declaration')]}"/>
                        <field name="rapport_diagnostique"
                               attrs="{'readonly': [('state', '!=', 'diagnostic')],
                   'invisible': [('state', '=', 'declaration')]}"/>
                        <field name="type_intervention"
                               attrs="{'readonly': [('state', '!=', 'diagnostic')],
                   'invisible': [('state', '=', 'declaration')]}"/>
                        <field name="besoin"
                               attrs="{
                           'readonly': [('state', '!=', 'diagnostic')],
                           'invisible': [('state', '=', 'declaration')]
                       }"/>

                        <field name="besoin_description"
                               attrs="{'invisible': [('besoin', '=', False)]}"/>

                        <field name="objet_intervention"
                               attrs="{'readonly': [('state', '!=', 'diagnostic')],
                   'invisible': [('state', '=', 'declaration')]}"/>
                        <field name="date_prevue"
                               attrs="{'readonly': [('state', '!=', 'diagnostic')],
                   'invisible': [('state', '=', 'declaration')]}"/>
                    </group>

                    <!-- Phase 3: Réalisation -->
                    <group>
                        <field name="existing_intervenant_realisation" string="Intervenant Existe"
                               attrs="{'readonly': [('state', '!=', 'realisation')]}"/>

                        <field name="intervenant_hr_realisation"
                               string="Nom et Prénom de l'Intervenant"
                               attrs="{
           'readonly': [('state', '!=', 'realisation')],
           'invisible': [('existing_intervenant_realisation', '=', False)]
       }"/>
                        <field name="intervenant"
                               string="Nom et Prénom de l'Intervenant (Manuel)"
                               attrs="{
           'readonly': [('state', '!=', 'realisation')],
           'invisible': [('existing_intervenant_realisation', '=', True)]
       }"/>
                        <field name="realisation_date"
                               attrs="{'readonly': [('state', '!=', 'realisation')],
                   'invisible': [('state', 'in', ['declaration', 'diagnostic'])]}"/>
                        <field name="constat"
                               attrs="{'readonly': [('state', '!=', 'realisation')],
                   'invisible': [('state', 'in', ['declaration', 'diagnostic'])]}"/>

                        <field name="spare_part_ids" string="Pièces de rechange"
                               attrs="{'readonly': [('state', '!=', 'realisation')]}">
                            <tree editable="bottom">
                                <field name="product_id"/>
                                <field name="name"/>
                                <field name="quantity"/>
                            </tree>
                        </field>

                        <field name="description_intervention"
                               attrs="{'readonly': [('state', '!=', 'realisation')],
                   'invisible': [('state', 'in', ['declaration', 'diagnostic'])]}"/>
                        <field name="action_corrective"
                               attrs="{
           'readonly': [('state', '!=', 'realisation')],
           'invisible': [('state', 'in', ['declaration', 'diagnostic'])]
       }"/>

                        <field name="action_corrective_description"
                               attrs="{
           'readonly': [('state', '!=', 'realisation')],
           'invisible': [('action_corrective', '=', False)]
       }"/>

                        <field name="validation_responsable"
                               attrs="{'readonly': [('state', '!=', 'realisation')],
                   'invisible': [('state', 'in', ['declaration', 'diagnostic'])]}"/>
                        <field name="raison_non_validation"
                               attrs="{'readonly': [('state', '!=', 'realisation')],
                   'invisible': [('state', 'in', ['declaration', 'diagnostic'])]}"/>
                    </group>

                    <!-- Phase 4: Efficacité -->
                    <group>
                        <field name="intervention_efficace"
                               attrs="{
           'readonly': [('state', '!=', 'efficacy')],
           'invisible': [('state', 'not in', ['efficacy', 'cloture'])]
       }"/>

                        <field name="intervention_commentaire"
                               attrs="{
           'readonly': [('state', '!=', 'efficacy')],
           'invisible': ['|', ('state', 'not in', ['efficacy', 'cloture']), ('intervention_efficace', '=', True)]
       }"/>

                        <field name="efficacy_date"
                               attrs="{
           'readonly': [('state', '!=', 'efficacy')],
           'invisible': ['|', ('state', 'not in', ['efficacy', 'cloture']), ('intervention_efficace', '=', False)]
       }"/>

                    </group>


                    <!-- Phase 5: Clôture -->
                    <group>
                        <field name="responsable_intervention"
                               attrs="{'readonly': [('state', '!=', 'cloture')],
                   'invisible': [('state', '!=', 'cloture')]}"/>
                        <field name="cloture_date"
                               attrs="{'readonly': [('state', '!=', 'cloture')],
                   'invisible': [('state', '!=', 'cloture')]}"/>
                    </group>

                    <!-- Buttons to move between phases -->
                    <footer>
                        <button name="move_to_diagnostic" string="Passer à Diagnostic" type="object"
                                attrs="{'invisible': [('state', '!=', 'declaration')]}"/>
                        <button name="move_to_realisation" string="Passer à Réalisation" type="object"
                                attrs="{'invisible': [('state', '!=', 'diagnostic')]}"/>
                        <button name="move_to_efficacy" string="Passer à Efficacité" type="object"
                                attrs="{'invisible': [('state', '!=', 'realisation')]}"/>
                        <button name="move_to_cloture" string="Passer à Clôture" type="object"
                                attrs="{'invisible': [('state', '!=', 'efficacy')]}"/>
                    </footer>
                </sheet>
            </form>
        </field>
    </record>
    <record id="view_maintenance_curative_list" model="ir.ui.view">
        <field name="name">maintenance.curative.list</field>
        <field name="model">maintenance.curative</field>
        <field name="arch" type="xml">
            <tree string="Fiche d'Intervention Curative">
                <!-- Always visible fields -->
                <field name="name" string="Séquence"/>
                <field name="equipment_id" string="Équipement"/>
                <field name="demandeur_hr" string="Demandeur HR"/>
                <field name="declaration_date" string="Date Déclaration"/>

                <!-- Optional hidden fields -->
                <field name="reference_interne" string="Référence Interne" optional="hide"/>
                <field name="sn" string="SN" optional="hide"/>

                <field name="nom_intervenant" string="Nom et Prénom de l'Intervenant" optional="hide"/>
                <field name="heure_debut" string="Date et Heure de Début" optional="hide"/>
                <field name="heure_fin" string="Date et Heure de Fin" optional="hide"/>
                <field name="rapport_diagnostique" string="Rapport Diagnostique" optional="hide"/>
                <field name="type_intervention" string="Type d'Intervention" optional="hide"/>
                <field name="besoin" string="Besoin" optional="hide"/>
                <field name="besoin_description" string="Détails du Besoin"
                       attrs="{'invisible': [('besoin', '=', False)]}" optional="hide"/>

                <field name="objet_intervention" string="Objet de l'Intervention" optional="hide"/>
                <field name="date_prevue" string="Date Prévue" optional="hide"/>

                <field name="intervenant" string="Intervenant" optional="hide"/>
                <field name="realisation_date" string="Date Réalisation" optional="hide"/>
                <field name="constat" string="Constat" optional="hide"/>
                <field name="description_intervention" string="Description de l'Intervention" optional="hide"/>
                <field name="action_corrective" string="Action Corrective Nécessaire ?" optional="hide"/>
                <field name="action_corrective_description" string="Détails de l'Action Corrective" optional="hide"/>
                <field name="validation_responsable" string="Validation Responsable" optional="hide"/>
                <field name="raison_non_validation" string="Raison de Non-Validation" optional="hide"/>

                <field name="intervention_efficace" string="Intervention Efficace ?" optional="hide"/>
                <field name="efficacy_date" string="Date Efficacité" optional="hide"/>
                <field name="intervention_commentaire" string="Commentaire" optional="hide"/>

                <field name="responsable_intervention" string="Responsable de l'Intervention" optional="hide"/>
                <field name="cloture_date" string="Date et Heure de Clôture" optional="hide"/>

                <field name="name" string="Fiche d'Intervention" optional="hide"/>
                <field name="date_intervention_souhaitee" string="Date Intervention Souhaitée" optional="hide"/>
            </tree>
        </field>
    </record>


    <!-- Nouvelle Vue Calendrier -->
    <record id="view_maintenance_curative_calendar" model="ir.ui.view">
        <field name="name">maintenance.curative.calendar</field>
        <field name="model">maintenance.curative</field>
        <field name="arch" type="xml">
            <calendar string="Fiche d'Intervention Curative" date_start="date_intervention_souhaitee">
                <field name="name"/>
                <field name="demandeur_hr"/>
                <field name="equipment_id"/>
                <field name="date_intervention_souhaitee"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <!-- Action to Open List View -->
    <record id="action_maintenance_curative_list" model="ir.actions.act_window">
        <field name="name">Fiches d'Intervention Curative</field>
        <field name="res_model">maintenance.curative</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_maintenance_curative_list"/>
    </record>

    <!-- Action to Open Calendar View -->
    <record id="action_maintenance_curative_calendar" model="ir.actions.act_window">
        <field name="name">Fiches d'Intervention Curative - Calendrier</field>
        <field name="res_model">maintenance.curative</field>
        <field name="view_mode">calendar</field>
        <field name="view_id" ref="view_maintenance_curative_calendar"/>
    </record>

    <!-- Menu Items -->
    <menuitem id="menu_maintenance_curative" name="Maintenance Curative" sequence="10"
              parent="maintenance.menu_maintenance_title"/>
    <menuitem id="menu_maintenance_curative_list" name="Liste des Fiches" parent="menu_maintenance_curative"
              action="action_maintenance_curative_list"/>
    <menuitem id="menu_maintenance_curative_calendar" name="Calendrier des Fiches" parent="menu_maintenance_curative"
              action="action_maintenance_curative_calendar"/>
</odoo>
