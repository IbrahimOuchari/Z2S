<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Tree View for Productivity Dashboard -->
    <record id="view_mrp_productivity_tree" model="ir.ui.view">
        <field name="name">mrp.productivity.tree</field>
        <field name="model">mrp.production</field>
        <field name="arch" type="xml">
            <tree string="Productivité des Opérations" create="false" delete="false"
            >  <!-- Domain filter for done state -->
                <field name="name" string="OF"/>  <!-- Manufacturing Order -->
                <field name="product_id" string="Article"/>  <!-- Product -->
                <field name="ref_product_client" string="Référence Article"/>  <!-- Client Reference -->
<!--                <field name="description" string="Désignation"/>  &lt;!&ndash; Description &ndash;&gt;-->
                <field name="qty_producing" string="Quantité Produite"/>  <!-- Produced Quantity -->
<!--                <field name="create_date" string="Date création OF"/>  &lt;!&ndash; Creation Date &ndash;&gt;-->
                <field name="date_realisation" string="Date Réalisation"/>  <!-- Realization Date -->
<!--                <field name="total_theo_duration" string="Durée Théorique" />  &lt;!&ndash; Theoretical Duration &ndash;&gt;-->
                <field name="formatted_theo_duration" string="Durée Théorique" />  <!-- Theoretical Duration -->
<!--                <field name="total_real_duration" string="Durée Réelle"/>  &lt;!&ndash; Real Duration &ndash;&gt;-->
                <field name="formatted_real_duration" string="Durée Réelle"/>  <!-- Real Duration -->
                <field name="total_average_productivity" string="Productivité"
                       widget="percentage"/>  <!-- Productivity -->
                <field name="state" string="Etat"/>  <!-- Status -->

            </tree>


        </field>
    </record>
    <record id="view_mrp_production_filter" model="ir.ui.view">
        <field name="name">mrp.production.productivity.search</field>
        <field name="model">mrp.production</field>
        <field name="arch" type="xml">
            <search string="Recherche Productivité">
                <!-- Filter by Manufacturing Order (OF) -->
                <field name="name" string="OF"/>

                <!-- Filter by Article (Product) -->
                <field name="product_id" string="Article"/>

                <!-- Date Filter -->
                <field name="create_date" string="Date de création" filter_domain="[('create_date', '>=', self)]"/>
                <filter invisible="1" string="Late Activities" name="activities_overdue"
                        domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                        help="Show all records which has next action date is before today"/>
                <filter invisible="1" string="Today Activities" name="activities_today"
                        domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter invisible="1" string="Future Activities" name="activities_upcoming_all"
                        domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]"/>
                <filter name="filter_date_realisation" string="Date réalisation" date="date_realisation"/>
                <filter name="filter_plan_date" invisible="1" string="Scheduled Date: Last 365 Days"
                        domain="[('date_realisation', '>', (datetime.datetime.now() + relativedelta(days=-365)).to_utc().strftime('%Y-%m-%d %H:%M:%S'))]"/>
                <separator/>


                <field name="state" string="State"/>
                <filter name="state_filter" string="Fait" domain="[('state','=','done')]"/>

                <!-- Grouping options -->
                <group expand="1" string="Group By">
                    <filter string="Article" name="group_by_product" context="{'group_by':'product_id'}"/>
                    <filter string="OF" name="group_by_OF" context="{'group_by':'name'}"/>

                </group>
            </search>
        </field>
    </record>

    <!-- Search View for Productivity Dashboard -->

    <!-- Action for Tree View with Filters -->
    <record id="action_productivity_analysis_tree" model="ir.actions.act_window">
        <field name="name">Productivité des Opérations</field>
        <field name="res_model">mrp.production</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_mrp_productivity_tree"/>
        <field name="context">{'search_default_state_filter':1}</field>
    </record>

    <!-- Menu item under "Analyse" -->
    <menuitem id="menu_productivity_analysis"
              name="Tableau de bord des Productivités"
              parent="mrp.menu_mrp_reporting"
              action="action_productivity_analysis_tree"
              sequence="15"/>
</odoo>
